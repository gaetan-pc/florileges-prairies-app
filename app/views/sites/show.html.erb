<% content_for :javascript_head do %> 
  <script src="//maps.google.com/maps/api/js?v=3.13&amp;sensor=false&amp;libraries=geometry" type="text/javascript"></script>
  <script src="//maps.google.com/maps/api/js?v=3.13&amp;sensor=false&amp;libraries=places" type="text/javascript"></script>
  <script src='//google-maps-utility-library-v3.googlecode.com/svn/tags/markerclustererplus/2.0.14/src/markerclusterer_packed.js' type='text/javascript'></script>  
<% end %>

<p id="notice"><%= notice %></p>

<!-- FOCUS -->
<div class="row">
  <div class="col-md-6">
    <div class="site-focus">
      <figure class="effect-dexter">
        <%= image_tag @site.photo_url.to_s %>
        <figcaption>
          <h2><%= @site.name %></h2>
          <p><strong>Code: </strong><%= @site.code %> <br>
            <strong>Adresse: </strong><%= @site.location %> <br>
            <strong>Coord GPS: </strong><%= @site.longitude %>,<%= @site.latitude %>
          </p>
          <%= link_to "edit", edit_site_path(@site) %>
        </figcaption>
      </figure>
    </div>
  </div>
  <!-- MAPS AND SKETCH -->
  <div class="col-md-6">
    <ul class="nav nav-pills nav-justified" id="pillSites">
      <li class="filter active"><a href="#carte" data-toggle="pill"><h4 class="glyphicon glyphicon-globe"></h4></a></li>
      <li class="filter"><a href="#sketch" data-toggle="pill"><h4 class="glyphicon glyphicon-picture"></h4></a></li>
    </ul>
    <div class="tab-content">
      <div class="tab-pane active" id="carte">
        <br>
        <div id="map-canvas" style='width: auto; height: 315px;'></div>
      </div> 
      <div class="tab-pane" id="sketch">
        <br>
        <% if @site.plan? %>
          <div class="frame-block">
          <div style='width: auto; height: 315px;'> <%= image_tag @site.plan_url(:medium).to_s %> </div>
          </div>
        <% else %>
          Pas d'image
        <% end %>
      </div>
    </div>  

  </div>
  <!-- END OF MAPS AND SKETCH -->
</div>
<br>
<!-- FICHES -->
<div class="row">
  <div class="col-md-4">
    <div class="the-box-landing border-color-left">
      <h3>FICHES DE GESTION</h3>
    </div>
    <div class="list-block">
      <ul>
      <% @site.gestions.each do |g| %>
        <li>
        <%= link_to edit_site_gestion_path(@site,g) do%>
         Fiche-gestion du <%= g.gestion_date %>  
        <% end %> | 
        <%= link_to site_gestion_path(@site,g), :data => { :confirm => "Attention cette action est irréversible! Confirmez-vous la suppresion de la fiche?" }, :method => :delete, class:'btn btn-danger btn-xs' do %> 
        <i class="glyphicon glyphicon-remove-sign"></i> Supprimer
        <% end %>
        </li> 
      <% end %>
      </ul>
      <br>
      
      <div class="action">
        <% unless @site.gestions.empty? %>
          <%= link_to "Créer une nouvelle fiche de gestion", new_site_gestion_path(@site), class:'btn btn-success center-block' %>
        <% else %>
          <%= link_to "Créer votre première fiche de gestion", new_site_gestion_path(@site), class:'btn btn-success center-block'%>
        <% end %>
      </div>
    </div>  
  </div>

  <div class="col-md-4">
    <div class="the-box-landing border-color-left">
      <h3>FICHES DE RELEVÉS</h3>
    </div>
    <div class="list-block">
      <ul>
      <% @site.releves.each do |r| %>
        <li>
          <%= link_to edit_site_releve_path(@site,r) do %>
          Fiche-relevés du <%= r.date %>
          <% end %> | 
          <%= link_to site_releve_path(@site,r), :data => { :confirm => "Attention cette action est irréversible! Confirmez-vous la suppresion de la fiche?" }, :method => :delete, class:'btn btn-danger btn-xs' do %>
           <i class="glyphicon glyphicon-remove-sign"></i> Supprimer
          <% end %>  
        </li> 
      <% end %>
      </ul>
      <br>
      
      <div class="action">
        <% unless @site.releves.empty? %>
          <%= link_to "Créer une nouvelle fiche de gestion", new_site_releve_path(@site), class:'btn btn-primary center-block' %>
        <% else %>
          <%= link_to "Créer votre première fiche de relevés", new_site_releve_path(@site), class:'btn btn-primary center-block'%>
        <% end %>
      </div>
    </div> 
  </div>
  
  <div class="col-md-4">
    <div class="the-box-landing border-color-left">
      <h3>ESPÈCES PRÉSENTES</h3>
    </div>
    <div class="list-block">
      <div class=""></div>
      <h3>espèces observées</h3>
    </div>
  </div>
</div>
<br>
<%= link_to sites_path, class:'btn btn-primary' do %>
  <i class="glyphicon glyphicon-chevron-left"></i> Retour à la liste des sites
<% end %> 
 | 
<%= link_to edit_site_path(@site), class:'btn btn-warning' do %>
  <i class="glyphicon glyphicon-pencil"></i> Modifier
<% end %>

<script type="text/javascript">
  handler = Gmaps.build('Google');
  handler.buildMap({ provider: {
    mapTypeId: 'hybrid'
    }, 
    internal: {id: 'map-canvas'}}, function(){
    markers = handler.addMarkers(<%=raw @hash.to_json %>);
    handler.bounds.extendWith(markers);
    handler.fitMapToBounds();
    handler.getMap().setZoom(17);
    for (marker in markers) {
      google.maps.event.addListener(marker, "click", function( evt ) {
          handler.getMap().setZoom(12);
      });
    }
  });
  google.maps.event.addDomListener(window, 'load', initialize);

</script>
<script type="text/javascript">
  $('.navmenu').offcanvas()
</script>
